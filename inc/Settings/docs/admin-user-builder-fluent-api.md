# Admin & User Settings Builder Fluent API Reference

## AdminSettings Builder Chain

| Level              | Fluent Method                | Signature                                                                                                                                                                         | Returns                                                   | Notes                                                                      |
| ------------------ | ---------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------- | -------------------------------------------------------------------------- |
| AdminSettings root | `settings_page`              | `settings_page(string $page_slug, string∣callable∣null $template = null, array $args = array())`                                                                                  | `AdminSettingsPageBuilder`                                | Convenience entry point for registering a single settings page.            |
| AdminSettings root | `menu_group`                 | `menu_group(string $group_slug)`                                                                                                                                                  | `AdminSettingsMenuGroupBuilder`                           | Begins explicit menu-group configuration.                                  |
| Menu group         | Metadata setters             | `heading(string $heading)`, `menu_label(string $menu_title)`, `capability(string $capability)`, `parent(?string $parent_slug)`, `icon(?string $icon)`, `position(?int $position)` | `self`                                                    | Update menu-group metadata immediately.                                    |
| Menu group         | `page`                       | `page(string $page_slug, string∣callable∣null $template = null, array $args = array())`                                                                                           | `AdminSettingsPageBuilder`                                | Creates a page builder for the given slug with optional template override. |
| Page               | `section`                    | `section(string $section_id, string $title, ?callable $description_cb = null, ?array $args = null)`                                                                               | `AdminSettingsSectionBuilder`                             | Emits section metadata and returns typed section builder.                  |
| Page               | `template`                   | `template(string∣callable∣null $template)`                                                                                                                                        | `self`                                                    | Registers root override or callback; last call wins.                       |
| Page               | `submit_controls`            | `submit_controls(?string $template = null)`                                                                                                                                       | `SubmitControlsBuilder`                                   | Opens submit-controls builder and clears defaults.                         |
| Page               | `page` (sibling)             | `page(string $page_slug, string∣callable∣null $template = null, array $args = array())`                                                                                           | `AdminSettingsPageBuilder`                                | Ends current page then opens another.                                      |
| Page               | `end_page`                   | `end_page()`                                                                                                                                                                      | `AdminSettingsMenuGroupBuilder`                           | Returns to the parent menu-group builder.                                  |
| Page               | `end`                        | `end()`                                                                                                                                                                           | `AdminSettings`                                           | Commits page and returns root settings instance.                           |
| Section            | `group`                      | `group(string $group_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                                                                                 | `AdminSettingsGroupBuilder`                               | Begins grouped fields within the section.                                  |
| Section            | `fieldset`                   | `fieldset(string $fieldset_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                                                                           | `AdminSettingsFieldsetBuilder`                            | Creates semantic fieldset with default wrapper.                            |
| Section            | `field`                      | `field(string $field_id, string $label, string $component, array $args = array())`                                                                                                | `AdminSettingsSectionBuilder` or `ComponentBuilderProxy`  | Adds field or returns proxy for component-specific fluency.                |
| Section            | `section` (sibling)          | `section(string $section_id, string $title, ?callable $description_cb = null, ?array $args = null)`                                                                               | `AdminSettingsSectionBuilder`                             | Ends current section and opens another within the same page.               |
| Section            | `end_section`                | `end_section()`                                                                                                                                                                   | `AdminSettingsPageBuilder`                                | Returns to the owning page builder.                                        |
| Group              | `field`                      | `field(string $field_id, string $label, string $component, array $args = array())`                                                                                                | `AdminSettingsGroupBuilder` or `ComponentBuilderProxy`    | Adds grouped field or yields component proxy.                              |
| Group              | `group` (sibling)            | `group(string $group_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                                                                                 | `AdminSettingsGroupBuilder`                               | Starts another group without returning to the section builder.             |
| Group              | `end_group`                  | `end_group()`                                                                                                                                                                     | `AdminSettingsSectionBuilder`                             | Returns to section scope.                                                  |
| Group              | `end_section`                | `end_section()`                                                                                                                                                                   | `AdminSettingsPageBuilder`                                | Shortcut back to the page builder.                                         |
| Fieldset           | `fieldset` (sibling)         | `fieldset(string $fieldset_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                                                                           | `AdminSettingsFieldsetBuilder`                            | Opens a sibling fieldset on the same section.                             |
| Fieldset           | `field`                      | `field(string $field_id, string $label, string $component, array $args = array())`                                                                                                | `AdminSettingsFieldsetBuilder` or `ComponentBuilderProxy` | Adds field within fieldset or returns proxy.                               |
| Fieldset           | `end_fieldset`               | `end_fieldset()`                                                                                                                                                                  | `AdminSettingsSectionBuilder`                             | Commits fieldset and returns to section scope.                             |
| Fieldset           | `end_section`                | `end_section()`                                                                                                                                                                   | `AdminSettingsPageBuilder`                                | Returns to the page builder.                                               |
| Submit controls    | `template`                   | `template(string∣callable∣null $template)`                                                                                                                                        | `self`                                                    | Sets or clears submit-controls wrapper override.                           |
| Submit controls    | `button`                     | `button(string $control_id, string $label, ?callable $configure = null)`                                                                                                          | `self`                                                    | Adds or updates submit button using shared button builder.                 |
| Submit controls    | `field`                      | `field(string $control_id, string $label, string $component, array $args = array())`                                                                                              | `self` or `ComponentBuilderProxy`                         | Registers arbitrary component within the submit zone.                      |
| Submit controls    | `before`, `after`            | `before(?callable $before)`, `after(?callable $after)`                                                                                                                            | `self`                                                    | Updates pre/post render callbacks for submit zone.                         |
| Submit controls    | `end`, `end_submit_controls` | `end()`, `end_submit_controls()`                                                                                                                                                  | `BuilderRootInterface`                                    | Returns to the owning page builder.                                        |

## UserSettings Builder Chain

| Level             | Fluent Method                                          | Signature                                                                                                                | Returns                                                  | Notes                                                         |
| ----------------- | ------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------- | ------------------------------------------------------------- |
| UserSettings root | `collection`                                           | `collection(string $id_slug = 'profile', string∣callable∣null $template = null, array $args = array())`                  | `UserSettingsCollectionBuilder`                          | Starts profile collection; mirrors AdminSettings root.        |
| Collection        | `heading`, `description`, `order`                      | `heading(string $heading)`, `description(string $description)`, `order(int $order)`                                      | `self`                                                   | Update collection metadata immediately.                       |
| Collection        | `template`                                             | `template(string∣callable∣null $template)`                                                                               | `self`                                                   | Registers root override or callback; last call wins.          |
| Collection        | `section`                                              | `section(string $section_id, string $title, ?callable $description_cb = null, ?array $args = null)`                      | `UserSettingsSectionBuilder`                             | Emits section metadata and returns typed builder.             |
| Collection        | `end_collection`, `end`                                | `end_collection()`, `end()`                                                                                              | `UserSettings`                                           | Commits collection and returns root settings instance.        |
| Section           | `group`                                                | `group(string $group_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                        | `UserSettingsGroupBuilder`                               | Begins grouped fields within the section.                     |
| Section           | `section` (sibling)                                    | `section(string $section_id, string $title, ?callable $description_cb = null, ?array $args = null)`                      | `UserSettingsSectionBuilder`                             | Opens another section within the same collection.             |
| Section           | `fieldset`                                             | `fieldset(string $fieldset_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                  | `UserSettingsFieldsetBuilder`                            | Semantic fieldset wrapper with default template.              |
| Section           | `section_template`, `field_template`, `group_template` | `section_template(string $template_key)`, `field_template(string $template_key)`, `group_template(string $template_key)` | `self`                                                   | Section-wide overrides for containers, fields, or groups.     |
| Section           | `field`                                                | `field(string $field_id, string $label, string $component, array $args = array())`                                       | `UserSettingsSectionBuilder`                             | Emits field data; optional field template triggers override.  |
| Section           | `end_section`                                          | `end_section()`                                                                                                          | `UserSettingsCollectionBuilder`                          | Returns to collection scope.                                  |
| Group             | `field`                                                | `field(string $field_id, string $label, string $component, array $args = array())`                                       | `UserSettingsGroupBuilder` or `ComponentBuilderProxy`    | Adds grouped field or yields component proxy.                 |
| Group             | `group` (sibling)                                      | `group(string $group_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                        | `UserSettingsGroupBuilder`                               | Opens another group without returning to the section builder. |
| Group             | `end_group`                                            | `end_group()`                                                                                                            | `UserSettingsSectionBuilder`                             | Returns to section scope.                                     |
| Group             | `end_section`                                          | `end_section()`                                                                                                          | `UserSettingsCollectionBuilder`                          | Shortcut back to the collection builder.                      |
| Fieldset          | `fieldset` (sibling)                                    | `fieldset(string $fieldset_id, string $heading, ?callable $description_cb = null, ?array $args = null)`                  | `UserSettingsFieldsetBuilder`                            | Opens a sibling fieldset within the same section.             |
| Fieldset          | `style`, `required`                                    | `style(string $style)`, `required(bool $required = true)`                                                                | `self`                                                   | Fieldset-specific metadata helpers.                           |
| Fieldset          | `field`                                                | `field(string $field_id, string $label, string $component, array $args = array())`                                       | `UserSettingsFieldsetBuilder` or `ComponentBuilderProxy` | Adds field within fieldset or returns proxy.                  |
| Fieldset          | `end_fieldset`                                         | `end_fieldset()`                                                                                                         | `UserSettingsSectionBuilder`                             | Commits fieldset and returns to section scope.                |
| Fieldset          | `end_section`                                          | `end_section()`                                                                                                          | `UserSettingsCollectionBuilder`                          | Returns to the collection builder.                            |

## Reading Saved Values (`get_value` / `get_values`)

All settings forms implement read helpers via `FormsInterface`:

- **`get_value`**
    - Signature: `get_value(string $field_id, mixed $default = null, ?array $context = null): mixed`
    - Returns the stored value for a single field ID.
- **`get_values`**
    - Signature: `get_values(?array $context = null): array`
    - Returns the full stored values array for the resolved context.

Context requirements differ by implementation:

- **AdminSettings**
    - **Context**: optional.
- **UserSettings**
    - **Context**: must resolve a target user.
    - Common keys:
        - `user_id` (required unless resolvable from current request)
        - `storage` (`meta` or `option`)
        - `global` (bool; only relevant when `storage` is `option`)
- **Metaboxes**
    - **Context**: required.
    - Common keys:
        - `metabox_id` (required; alternatively `id_slug`)
        - `post_id` (required for post-meta reads)

## Component Builder Proxy (Fields)

When `field()` resolves to a registered component builder, the method returns a `ComponentBuilderProxy`. The proxy exposes the component-specific fluent API (e.g. `order()`, `variant()`, `attributes()`) while routing template overrides through the shared session pipeline, preserving last-call-wins semantics.
